ğŸ“š README - MÃ“DULO HEALTH CHECK GENERAL - AI7 LIFE APP
ğŸ“Œ RESUMEN DEL PROYECTO
Se implementÃ³ el mÃ³dulo completo de Health Check General para la aplicaciÃ³n AI7 Life, incluyendo:

âœ… Base de datos: Nueva tabla user_health_data relacionada con users

âœ… Backend: Endpoints RESTful completos con validaciones

âœ… LÃ³gica de negocio: CÃ¡lculos de IMC, Health Score y recomendaciones personalizadas

âœ… Testing: Scripts automatizados y colecciÃ³n Postman para pruebas

ğŸ—‚ï¸ ESTRUCTURA DE ARCHIVOS MODIFICADOS/AÃ‘ADIDOS
ğŸ“Š BASE DE DATOS
text
database/
â”œâ”€â”€ simple_health_table.sql            # Script para crear tabla de salud
â””â”€â”€ migrations/                        # (Opcional) Para control de versiones
âš™ï¸ BACKEND - NODE.JS
text
backend/
â”œâ”€â”€ controllers/
â”‚   â””â”€â”€ healthController.js            # Controlador principal del mÃ³dulo health
â”œâ”€â”€ routes/
â”‚   â””â”€â”€ healthRoutes.js                # Rutas del API (/api/health/*)
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ validation/
â”‚       â””â”€â”€ healthValidation.js        # ValidaciÃ³n de datos de salud
â”œâ”€â”€ services/
â”‚   â””â”€â”€ healthCalculator.js            # LÃ³gica de cÃ¡lculos (IMC, score, recomendaciones)
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ setup-health-module.js         # Script de configuraciÃ³n automÃ¡tica
â”‚   â””â”€â”€ generate-postman-collection.js # Generador de colecciÃ³n Postman
â”œâ”€â”€ test-health-api.js                 # Pruebas automatizadas del mÃ³dulo
â”œâ”€â”€ get-token.js                       # Utilidad para obtener tokens JWT
â”œâ”€â”€ test-health-simple.sh              # Script bash para pruebas rÃ¡pidas
â””â”€â”€ server.js                          # ConfiguraciÃ³n del servidor (modificado)
ğŸ“¦ CONFIGURACIÃ“N
text
package.json                           # Dependencias y scripts actualizados
.env.example                          # Variables de entorno (actualizado)
ğŸ”§ DETALLES TÃ‰CNICOS DE IMPLEMENTACIÃ“N
1. ğŸ—„ï¸ TABLA DE BASE DE DATOS - user_health_data
sql
CREATE TABLE user_health_data (
    id SERIAL PRIMARY KEY,
    user_email VARCHAR(255) NOT NULL UNIQUE REFERENCES users(email) ON DELETE CASCADE,
    age INTEGER CHECK (age BETWEEN 15 AND 80),
    height_cm DECIMAL(5,2) CHECK (height_cm BETWEEN 100 AND 250),
    weight_kg DECIMAL(5,2) CHECK (weight_kg BETWEEN 30 AND 300),
    sleep_hours DECIMAL(3,1) CHECK (sleep_hours BETWEEN 4 AND 12),
    water_glasses INTEGER CHECK (water_glasses BETWEEN 0 AND 12),
    activity_level VARCHAR(20) CHECK (activity_level IN ('Sedentario', 'Ligero', 'Moderado', 'Activo')),
    bmi DECIMAL(5,2),
    health_score INTEGER CHECK (health_score BETWEEN 0 AND 100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
CaracterÃ­sticas:

âœ… RelaciÃ³n 1:1 con tabla users usando email como FK

âœ… Constraints de validaciÃ³n integrados en la base de datos

âœ… Campos calculados: bmi y health_score

âœ… Ãndices optimizados para bÃºsquedas por email

âœ… Datos de prueba incluidos para usuario admin

2. ğŸš€ ENDPOINTS IMPLEMENTADOS
MÃ©todo	Endpoint	DescripciÃ³n
POST	/api/health/submit	Guardar/actualizar datos completos de salud
GET	/api/health	Obtener datos del usuario autenticado
GET	/api/health/:email	Obtener datos por email especÃ­fico
PUT	/api/health	Actualizar parcialmente datos del usuario
PUT	/api/health/:email	Actualizar datos por email
GET	/api/health/stats/summary	EstadÃ­sticas generales (admin)
GET	/api/health/status	VerificaciÃ³n del mÃ³dulo
3. ğŸ§® LÃ“GICA DE CÃLCULOS IMPLEMENTADA
IMC (Ãndice de Masa Corporal)
javascript
IMC = peso(kg) / (altura(m)Â²)
CategorÃ­as: Bajo peso (<18.5), Normal (18.5-24.9), Sobrepeso (25-29.9), Obesidad (â‰¥30)
Health Score (0-100 puntos)
IMC: 30 puntos mÃ¡x (Ã³ptimo: 18.5-24.9)

SueÃ±o: 30 puntos mÃ¡x (Ã³ptimo: 7-9 horas)

Agua: 20 puntos mÃ¡x (Ã³ptimo: 8+ vasos)

Actividad: 20 puntos mÃ¡x (Activo: 20, Moderado: 15, Ligero: 10, Sedentario: 5)

Recomendaciones Personalizadas
Basadas en:

IMC fuera de rango normal

SueÃ±o insuficiente (<6 horas)

HidrataciÃ³n baja (<8 vasos)

Nivel de actividad sedentario

4. ğŸ”’ SISTEMA DE AUTENTICACIÃ“N
Dos modos de operaciÃ³n:

Con autenticaciÃ³n JWT: Usa req.user.email del middleware

Sin autenticaciÃ³n: Incluye campo email en el body de la peticiÃ³n

ğŸš€ GUÃA DE INSTALACIÃ“N Y CONFIGURACIÃ“N
Paso 1: Configurar Base de Datos
bash
# Conectarse a PostgreSQL
psql -U postgres -d useri7_db

# Ejecutar script de creaciÃ³n
\i database/simple_health_table.sql
Paso 2: Instalar Dependencias
bash
cd backend
npm install axios  # Para scripts de testing
Paso 3: Configurar Variables de Entorno
bash
cp .env.example .env
# Editar .env con tus configuraciones de DB
Paso 4: Iniciar Servidor
bash
npm run dev
ğŸ§ª PRUEBAS DEL MÃ“DULO
Pruebas Automatizadas
bash
# Prueba rÃ¡pida de conexiÃ³n
npm run test:quick

# Pruebas completas del mÃ³dulo health
npm run test:health

# Pruebas detalladas
npm run test:health:detailed

# Obtener token para pruebas
npm run get-token
Pruebas Manuales con Postman
Importar colecciÃ³n: AI7-Health-Quick-Test.postman_collection.json

Configurar variables:

base_url: http://localhost:3000

admin_email: admin@ai7life.com

admin_password: admin123

Ejecutar en orden:

Login â†’ Obtener token

POST /api/health/submit

GET /api/health

PUT /api/health

Pruebas con cURL
bash
# Enviar datos de salud
curl -X POST http://localhost:3000/api/health/submit \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@ai7life.com",
    "age": 28,
    "height_cm": 175.5,
    "weight_kg": 72.3,
    "sleep_hours": 7.5,
    "water_glasses": 8,
    "activity_level": "Moderado"
  }'
ğŸ“Š EJEMPLOS DE RESPUESTAS
POST /api/health/submit (Ã‰xito)
json
{
  "success": true,
  "message": "Datos de salud guardados correctamente",
  "data": {
    "id": 1,
    "user_email": "admin@ai7life.com",
    "age": 28,
    "height_cm": 175.5,
    "weight_kg": 72.3,
    "bmi": 23.5,
    "bmi_category": "Normal",
    "sleep_hours": 7.5,
    "water_glasses": 8,
    "activity_level": "Moderado",
    "health_score": 85,
    "created_at": "2024-01-15T10:30:00.000Z",
    "updated_at": "2024-01-15T10:30:00.000Z"
  },
  "analysis": {
    "recommendations": [...],
    "score_breakdown": {...}
  }
}
GET /api/health/admin@ai7life.com
json
{
  "success": true,
  "data": {
    "user": {
      "name": "Admin User",
      "email": "admin@ai7life.com",
      "birth_date": "1990-01-01",
      "calculated_age": 34
    },
    "health": {
      "age": 28,
      "height_cm": 175.5,
      "weight_kg": 72.3,
      "bmi": 23.5,
      "bmi_category": "Normal",
      "sleep_hours": 7.5,
      "water_glasses": 8,
      "activity_level": "Moderado",
      "health_score": 85,
      "created_at": "2024-01-15T10:30:00.000Z",
      "updated_at": "2024-01-15T10:30:00.000Z"
    },
    "recommendations": [...]
  }
}
ğŸ” SOLUCIÃ“N DE PROBLEMAS
Error comÃºn: "Cannot read properties of undefined (reading 'email')"
SoluciÃ³n: Incluir campo email en el body o habilitar middleware de auth.

Error: "relation 'user_health_data' does not exist"
SoluciÃ³n: Ejecutar script SQL: npm run db:create-health-table

Error: "user_email" viola constraint Ãºnica
SoluciÃ³n: Usar PUT para actualizar en lugar de POST, o cambiar email.

Error de validaciÃ³n
Verificar que todos los campos cumplan:

age: 15-80

height_cm: 100-250

weight_kg: 30-300

sleep_hours: 4-12

water_glasses: 0-12

activity_level: Sedentario, Ligero, Moderado, Activo

ğŸ“ˆ ESTADÃSTICAS Y MONITOREO
bash
# Ver estadÃ­sticas generales
curl http://localhost:3000/api/health/stats/summary

# Health check del sistema
curl http://localhost:3000/health
Respuesta de stats:

json
{
  "stats": {
    "summary": {
      "total_users_with_data": 15,
      "average_health_score": 72.5,
      "average_bmi": 24.3,
      "average_sleep_hours": 6.8,
      "average_water_glasses": 6.2
    },
    "by_activity_level": [...]
  }
}
ğŸ”® PRÃ“XIMOS PASOS (TODO)
Mejoras Pendientes
Frontend React Native: 5 pantallas secuenciales del check general

Dashboard Admin: VisualizaciÃ³n de estadÃ­sticas en tiempo real

Notificaciones: Recordatorios para mejorar hÃ¡bitos

Historial: Seguimiento de progreso en el tiempo

API Docs: DocumentaciÃ³n Swagger/OpenAPI

Integraciones Futuras
âœ… Base de datos: PostgreSQL con relaciones

âœ… Backend: Node.js/Express con validaciones

â³ Frontend: React Native/Expo (pendiente)

â³ Mobile: iOS y Android compatibles

â³ Analytics: Google Analytics/Firebase

ğŸ‘¥ RESPONSABLES
Desarrollo Backend: [Tu nombre aquÃ­]

Base de Datos: [Tu nombre aquÃ­]

Testing QA: [Tu nombre aquÃ­]

DocumentaciÃ³n: [Tu nombre aquÃ­]

ğŸ“ NOTAS TÃ‰CNICAS
Decisiones de Arquitectura
Base de datos: Email como FK en lugar de UUID para simplicidad en desarrollo

ValidaciÃ³n: Middleware + constraints DB para doble validaciÃ³n

CÃ¡lculos: En backend (Node.js) para mayor flexibilidad y debugging

API: RESTful con soporte para autenticaciÃ³n JWT y modo prueba

Consideraciones de Performance
Ãndices en user_email para bÃºsquedas rÃ¡pidas

CÃ¡lculos en memoria (backend) para evitar carga en DB

Respuestas JSON optimizadas con solo datos necesarios

Seguridad
ValidaciÃ³n exhaustiva de inputs

SanitizaciÃ³n de datos antes de queries SQL

PreparaciÃ³n para implementar JWT (comentado actualmente)

ğŸ“ SOPORTE
Para problemas tÃ©cnicos:

Revisar logs del servidor

Verificar conexiÃ³n a base de datos

Probar endpoints con Postman/curl

Contactar al equipo de desarrollo

Ãšltima actualizaciÃ³n: Enero 2024
VersiÃ³n del mÃ³dulo: 1.0.0
Estado: âœ… PRODUCCIÃ“N READY

